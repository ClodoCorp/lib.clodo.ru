<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	
		<title>Fail2ban</title>
	
	
	<meta name="keywords" content="хостинг, виртуальный сервер, vds, vps, cloud" />
	<meta name="description" content="База знаний поможет Вам в вопросах администрирования Вашего виртуального сервера VPS/VDS. База знаний содержит материалы по развертыванию широкого спектра серверных решений, от веб-серверов с базами данных до более сложных конфигураций." />
	<link rel="stylesheet" href="/pstyle.css" type="text/css" media="screen" />

	<link rel="shortcut icon" href="http://lib.clodo.ru/favicon.ico" />
	<link rel="image_src" href="http://lib.clodo.ru/favicon.ico" />

	<!--[if IE]>

		<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>

		<script type="text/javascript" src="/js/excanvas.js"></script>
		<style type="text/css">
		table.header td {
			padding:0;
		}
		.contentcolumn div.serverlist {
			width: 40%;
			margin: 15px 3% 25px 3%;
		}
		table.header td.menu table.main_menu div {
			margin-left: 2px;
		}
		</style>
	<![endif]-->

	<!-- GOOGLE SEARCH -->
	<script>
	  (function() {
	    var cx = '005661710072474951780:6ywyu3asnyk';
	    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
	    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
	  })();
	</script>
</head>

<body>

<!-- test -->
	<table cellpadding="0" cellspacing="0" border="0" width="100%">
	<tr><td height="115">
		<div class="botsi"></div>
		<div class="header"></div>
		<table cellpadding="0" cellspacing="0" width="100%" border="0" class="header">
			<tr>
				<td rowspan="2" class="logo"><a href="/"><img src="/images/def_skin/logo.png" border="0" alt="Панель управления хостингом CLODO.RU" /></a></td>
				<td rowspan="2" class="slog">
					<p><nobr>База знаний Clodo.ru</nobr><br /> <font class="mslink"><a href="http://www.clodo.ru">Перейти на сайт clodo.ru</a></font></p>
				</td>
				<td class="user" align="right">
				
				<!-- GOOGLE SEARCH BOX -->
				<div class='searchbox'>
					<gcse:searchbox-only newWindow="false" enableAutoComplete='true'></gcse:searchbox-only>
				</div>
				<!-- /GOOGLE SEARCH BOX -->
				
				</td> 
			</tr>
			<tr>
				<td class="menu" align="right" valign="bottom">
		


					<table cellpadding="0" cellspacing="0" border="0" class="main_menu">
						<tr>
							<td><div><a href="http://panel.clodo.ru/">Панель управления</a></div></td>
							<td class="menusep">&nbsp;</td>
							<td><div><a href="http://forum.clodo.ru">Форум&nbsp;поддержки</a></div></td>
							<td class="menusep">&nbsp;</td>
							<td><div class="current"><a href="/">База знаний</a></div></td>

						</tr>
					</table>

				</td>
			</tr>
		</table>
	</td></tr>
	<tr><td valign="top">
		<div class="maincontainer">
		<table cellpadding="0" cellspacing="0" width="100%" style="padding: 0 30px;">
			<tr>
				<td valign="top" width="20%">
				<div class="balanceblock">
				<div class="cashflow">


					<!-- LEFT MENU -->
					<div class="categoryhead"><b>Разделы базы знаний</b></div>

						
							
							

							
								<div class="category1item"><a href="/clodo/">Хостинг Clodo.ru</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/cloud-storage/">Облачное хранилище</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/vps-control-panel/">Панели управления VPS</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/getting-started/">Первые шаги</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/linux/">Используем Linux</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/CMS/">CMS</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/web-server/">WEB-Сервер</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/email/">Email</a></div>
							
						
							
							

							
								<div class="category1item nobottomborder"><a href="/linux-security/">Безопасность</a></div>
								<div class="category2item">
									
											<div class="category1item"><a href="/linux-security/fail2ban.html">Fail2ban</a></div>
									
											<div class="category1item"><a href="/linux-security/basic_security.html">Базовые приёмы</a></div>
									
								</div>
							
						
							
							

							
								<div class="category1item"><a href="/network/">Сеть</a></div>
							
						
							
					</div>
					<!-- !LEFT MENU -->

				</div>
				</td>
				<td valign="top" width="80%" class="maintd">
			<div class="contentwrapper">
				<div class="contentcolumn" style="margin-left: 0;">
					<div class="innertube">

	<!-- TOP NAVIBAR _ START-->
<div class="crosh">
	<a href="/">База знаний</a> ::
	<a href="/linux-security/">Безопасность</a> :: 
	Fail2ban
</div>
<!-- TOP NAVIBAR _ END-->

<h1>Описание работы с утилитой Fail2ban</h1>

<!-- ARTICLE _ START -->
<ul id="markdown-toc">
  <li><a href="#section">Установка</a></li>
  <li><a href="#section-1">Настройка</a></li>
</ul>

<p>Fail2ban - это инструмент, который отслеживает в log-файлах попытки обратится к сервисам, таким, как SSH, FTP, SMTP, HTTP и другим, и если находит постоянно повторяющиеся неудачные попытки авторизации с одного и того же IP-адреса или хоста, fail2ban блокирует дальнейшие попытки с этого IP-адреса/хоста, с помощью правила iptables(ipfw) или host.deny.</p>

<p class="tip">Важно понимать, что <strong>fail2ban это не единственное средство предотвращения несанкционированного доступа к сервисам на вашем сервере</strong>. Данный инструмент не поможет, если запросы авторизации приходят с очень большого числа хостов (например ботнет).</p>

<p><strong>Все дальнейшие операции стоит выполнять с правами суперпользователя.</strong></p>

<h2 id="section">Установка</h2>

<p>Ubuntu/Debian:</p>

<pre><code>apt-get install fail2ban
</code></pre>

<p>CentOS/Fedora:</p>

<pre><code>yum install fail2ban
</code></pre>

<h2 id="section-1">Настройка</h2>

<p>После установки вам нужно будет установить правила блокировки для различных сервисов (шаблоны для основных сервисов уже есть в дистрибутиве). Для этого отредактируйте файл <code>/etc/fail2ban/jail.conf</code></p>

<p>В разделе <code>[DEFAULT]</code> содержатся настройки блокировки по-умолчанию. Параметры:</p>

<table>
  <tbody>
    <tr>
      <td>ignoreip</td>
      <td>IP-адрес, который не будет блокироваться в любом случае. Здесь можно указать IP-адрес, CIDR-маску или же имя DNS-хоста;</td>
    </tr>
    <tr>
      <td>bantime</td>
      <td>время в секундах, на которое будет блокироваться доступ;</td>
    </tr>
    <tr>
      <td>maxretry</td>
      <td>количество неудачных попыток авторизации, после которых хост будет заблокирован на bantime секунд;</td>
    </tr>
    <tr>
      <td>destemail</td>
      <td>email-адрес, на который будут отсылаться уведомления о блокировании хостов.</td>
    </tr>
  </tbody>
</table>

<p>Так же в конфигурационном файле содержатся настройки для отдельных сервисов. Рассмотрим на примере блокировку доступа к SSH (она включена по-умолчанию).</p>

<p>Найдите секцию [ssh]</p>

<blockquote>
  <p>enabled = true<br />
# означает, что данное правило активно<br />
port = ssh<br />
# указывается порт, который будет заблокирован для хоста<br />
filter = sshd<br />
# фильтр-файл с правилами блокировки, используемый для данного правила<br />
logpath = /var/log/auth.log<br />
# log-файл<br />
maxretry = 4 #количество неудачных попыток авторизации, после которых хост будет заблокирован на bantime секунд (по-умолчанию используется значение bantime из секции [DEFAULT]).  </p>
</blockquote>

<p>Параметры по-умолчанию, указанные в секции <code>[DEFAULT]</code> можно переопределять для каждой секции отдельно.</p>

<p>Аналогично настраиваются и другие правила. В настоящей статье указаны далеко не все параметры конфигурирования fail2ban. За более подробной информацией вы можете обратиться к <a href="http://www.fail2ban.org/wiki" title="fail2ban wiki">wiki fail2ban</a>.</p>


<!-- ARTICLE _ END -->

<h6 class="usl">Условия использования документа</h6>
<p>Материал представленный на данной странице может быть использован Вами по своему усмотрению. Разрешается копирование и распространение предоставленного материала без изменения содержания и без предварительного уведомления администрации <a class='out' target='_blank' href="http://www.clodo.ru">Clodo.ru</a>.</p>
<p>Мы будем признательны Вам за сообщения об ошибках в представленной документации и за предложения об улучшении документации. По этим вопросам необходимо обращаться по адресу <a href="mailto:mail@clodo.ru">mail@clodo.ru</a>. При обращении не забывайте указывать URL-адрес публикации.</p>

					</div>
				</div>
			</div>

				</td>
			</tr>
		</table>
		</div>

			<div class="footer">
				Техническая поддержка: <a href="mailto:support@clodo.ru">support@clodo.ru</a> | СПб: +7 (812) 380-24-97 | Москва: +7 (499) 504-98-28 | Jabber: support@clodo.ru
			</div>

	</td></tr>
	</table>

</body>
</html>
