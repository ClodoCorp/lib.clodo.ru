<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	
		<title>Создание резервной копии на Cloud Storage</title>
	
	
	<meta name="keywords" content="хостинг, виртуальный сервер, vds, vps, cloud" />
	<meta name="description" content="База знаний поможет Вам в вопросах администрирования Вашего виртуального сервера VPS/VDS. База знаний содержит материалы по развертыванию широкого спектра серверных решений, от веб-серверов с базами данных до более сложных конфигураций." />
	<link rel="stylesheet" href="/pstyle.css" type="text/css" media="screen" />

	<link rel="shortcut icon" href="http://lib.clodo.ru/favicon.ico" />
	<link rel="image_src" href="http://lib.clodo.ru/favicon.ico" />

	<!--[if IE]>

		<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>

		<script type="text/javascript" src="/js/excanvas.js"></script>
		<style type="text/css">
		table.header td {
			padding:0;
		}
		.contentcolumn div.serverlist {
			width: 40%;
			margin: 15px 3% 25px 3%;
		}
		table.header td.menu table.main_menu div {
			margin-left: 2px;
		}
		</style>
	<![endif]-->
</head>

<body>


	<table cellpadding="0" cellspacing="0" border="0" width="100%">
	<tr><td height="115">
		<div class="botsi"></div>
		<div class="header"></div>
		<table cellpadding="0" cellspacing="0" width="100%" border="0" class="header">
			<tr>
				<td rowspan="2" class="logo"><a href="/"><img src="/images/def_skin/logo.png" border="0" alt="Панель управления хостингом CLODO.RU" /></a></td>
				<td rowspan="2" class="slog">
					<p><nobr>База знаний Clodo.ru</nobr><br /> <font class="mslink"><a href="http://www.clodo.ru">Перейти на сайт clodo.ru</a></font></p>
				</td>
				<td class="user" align="right">
				<!--
					<form action="/search/" method="get" enctype="multipart/form-data"><font style="font-size: 14px;">Поиск по базе знаний</font> <input type="text" size="50" name="search" value=""><input type="submit" id="do" value="Искать" title="Search"></form>
				-->
				</td> 
			</tr>
			<tr>
				<td class="menu" align="right" valign="bottom">
		


					<table cellpadding="0" cellspacing="0" border="0" class="main_menu">
						<tr>
							<td><div><a href="http://panel.clodo.ru/">Панель управления</a></div></td>
							<td class="menusep">&nbsp;</td>
							<td><div><a href="http://forum.clodo.ru">Форум&nbsp;поддержки</a></div></td>
							<td class="menusep">&nbsp;</td>
							<td><div class="current"><a href="/">База знаний</a></div></td>

						</tr>
					</table>

				</td>
			</tr>
		</table>
	</td></tr>
	<tr><td valign="top">
		<div class="maincontainer">
		<table cellpadding="0" cellspacing="0" width="100%" style="padding: 0 30px;">
			<tr>
				<td valign="top" width="20%">
				<div class="balanceblock">
				<div class="cashflow">


					<!-- LEFT MENU -->
					<div class="categoryhead"><b>Разделы базы знаний</b></div>

						
							
							

							
								<div class="category1item"><a href="/clodo/">Хостинг Clodo.ru</a></div>
							
						
							
							

							
								<div class="category1item nobottomborder"><a href="/cloud-storage/">Облачное хранилище</a></div>
								<div class="category2item">
									
											<div class="category1item"><a href="/cloud-storage/cloudstorage.html">Облачное хранилище Clodo</a></div>
									
											<div class="category1item"><a href="/cloud-storage/subdomain_for_cloudstorage.html">Привязка поддомена</a></div>
									
											<div class="category1item"><a href="/cloud-storage/ftp_to_cs.html">FTP сервер для CloudStorage</a></div>
									
											<div class="category1item"><a href="/cloud-storage/cyberduck.html">Cyberduck</a></div>
									
											<div class="category1item"><a href="/cloud-storage/backupninja-cloud.html">Создание резервной копии на Cloud Storage</a></div>
									
								</div>
							
						
							
							

							
								<div class="category1item"><a href="/vps-control-panel/">Панели управления VPS</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/getting-started/">Первые шаги</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/linux/">Используем Linux</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/CMS/">CMS</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/web-server/">WEB-Сервер</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/email/">Email</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/linux-security/">Безопасность</a></div>
							
						
							
							

							
								<div class="category1item"><a href="/network/">Сеть</a></div>
							
						
							
					</div>
					<!-- !LEFT MENU -->

				</div>
				</td>
				<td valign="top" width="80%" class="maintd">
			<div class="contentwrapper">
				<div class="contentcolumn" style="margin-left: 0;">
					<div class="innertube">

	<!-- TOP NAVIBAR _ START-->
<div class="crosh">
	<a href="/">База знаний</a> ::
	<a href="/cloud-storage">Облачное хранилище</a> :: 
	Создание резервной копии на Cloud Storage
</div>
<!-- TOP NAVIBAR _ END-->

<h1>Backupninja</h1>

<!-- ARTICLE _ START -->
<h2 id="cloud-storage">Создание резервной копии на Cloud Storage</h2>

<ul id="markdown-toc">
  <li><a href="#cloud-storage">Создание резервной копии на Cloud Storage</a></li>
  <li><a href="#section">Описание</a></li>
  <li><a href="#section-1">Установка</a></li>
  <li><a href="#section-2">Создание задания</a></li>
  <li><a href="#section-3">Запуск задания</a></li>
  <li><a href="#section-4">Восстановление файлов</a></li>
</ul>

<h2 id="section">Описание</h2>

<p>Для создания резерваной копии на облачное хранилище, можно использовать утилиту Backupninja и плагины, позволяющие загружать данные в хранилище.</p>

<p>Backupninja-cloud представляет собой плагин для утилиты Backupninja.
При помощи него можно создавать резервные копии и загружать их на Clodo Cloud Storage</p>

<h2 id="section-1">Установка</h2>

<p>Для того, чтобы это сделать, необходимо сперва установить следующее ПО:</p>

<ul>
  <li>
    <dl>
      <dt>backupninja</dt>
      <dd>утилита для управления создания резервных копий</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>duplicity</dt>
      <dd>утилита для создание инкрементированных резервных копий</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>python-cloudfiles</dt>
      <dd>библиотека для поддержки облачных хранилищ</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>backupninja-cloud</dt>
      <dd>плагин для работы с облачным хранилищем</dd>
    </dl>
  </li>
</ul>

<p>Для установки на Debian 6 можно воспользоваться скриптом для автоматической установки:</p>

<pre><code>wget http://cs.aylium.net/scripts/backupninja-cloud-debian.sh
chmod +x backupninja-cloud-debian.sh
./backupninja-cloud-debian.sh
</code></pre>

<h2 id="section-2">Создание задания</h2>

<p>После успешной установки, можно приступить к настройке резервной копии файлов. Она производится при помощи ninjahelper:</p>

<pre><code>ninjahelper
</code></pre>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_001.png" alt="" /></p>

<p>Создание нового задания для резервного копирования начинается с выбора типа резервного копирования. В данном случае - csdup.</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_002.png" alt="" /></p>

<p>В главном меню создания задания необходимо пошагово указать все необходимые данные.
<img src="http://static.clodo.ru/lib-images/backupninja/bn_cloud_003.png" alt="" /></p>

<h6 id="src-source"><strong>src</strong> (source)</h6>

<p>Здесь необходимо указать директории, которые будут загружены в хранилище</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_004.png" alt="" /></p>

<p>Exclude позволяет указать файлы, которые не будут включены в резервную копию</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_005.png" alt="" /></p>

<h6 id="dest-destination"><strong>dest</strong> (destination)</h6>

<p>На данном этапе указываются для загрузки резервной копии в хранилище:</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_006.png" alt="" /></p>

<p>Параметры, <strong>обязательные</strong> для заполнения для исправной работы системы резервного копирования:</p>

<dl>
  <dt>storage</dt>
  <dd>уникальный идетификатор хранилища</dd>
  <dt>apikey</dt>
  <dd>уникальный ключ хранилища</dd>
</dl>

<p><em>Подсказка:</em> (storage и apikey можно узнать из <a href="https://panel.clodo.ru/#storage/">панели управления</a>)</p>

<dl>
  <dt>container</dt>
  <dd>название контейнера, который будет создан и в котором будет храниться резервная копия конкретного задания. Для каждого задания лучше всего создавать отдельный контейнер. <strong>Обратите внимание</strong>, что контейнер должен иметь только один уровень - корневой.</dd>
  <dt>name</dt>
  <dd>название задания для резервного копирования. Будет совпадать с названием задания на создание резервной копии и ее откат. Необходимо для идентификации самого задания, чтобы не возникало путаницы.</dd>
</dl>

<p>Опциональные параметры, которые могут быть оставлены настроенными по-умолчанию:</p>

<dl>
  <dt>keep</dt>
  <dd>количество дней в течение которых будет храниться резервная копия</dd>
  <dt>incremental</dt>
  <dd>инкременитровать резервную копию или нет (принимает значения yes/no)</dd>
  <dt>increments</dt>
  <dd>количество дней, по истечению которых резервная копия будет сделана с нуля</dd>
</dl>

<h6 id="gpg-gnu-privacy-guard"><strong>gpg</strong> (gnu privacy guard)</h6>

<p>Здесь Вам нужно указать пароль, при которым будет зашифрована резервная копия</p>

<h6 id="adv-advanced"><strong>adv</strong> (advanced)</h6>

<p>В данной секции оставьте все значения по-умолчанию. Просто нажмите Enter.</p>

<p>Если Вы выполнили все шаги, то напротив каждого пункту появится надпись (Done)</p>

<p>Нажмите “Finish” чтобы создать задание</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_007.png" alt="" /></p>

<p>Теперь, в главном меню программы отобразится созданное задание:</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_008.png" alt="" /></p>

<p>Также, в дирекотрии /root/.restore/ будет создан файл с названием taskname.cstask, где taskname - это слово, которые было указано в пункте name. В данном файле хранится информация для восстановления файлов из резервной копии. Это можно сделать как на текщем сервере, так и на удаленном ПК, с установленным и настроенным ПО (duplicity, python-cloudfiles). Желательно создать резервную копию даннных файлов, т.к. в них содержится вся информация для автоматического восстановления данных.</p>

<h2 id="section-3">Запуск задания</h2>

<p>Выберите задание из списка и откройте его, нажав “Enter”. Теперь можно протестировать его выполнение в пределах текущего сервера (уточнить параметры для duplicity).</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_009.png" alt="" /></p>

<p>Обычно, с тестом проблем не возникает, и вы можете сраз перейти к проверке создания резервной копии в хранилище. Для этого нажмите “Run”.</p>

<p>Пример успешно отработанного задания:</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_010.png" alt="" /></p>

<p>Теперь, в панели управления хранилищем можно зайти в созданный контейнер и увидеть следующие файлы. Как уже говорилось ранее - данные хранятся в зашифрованном виде.</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_012.png" alt="" /></p>

<h2 id="section-4">Восстановление файлов</h2>

<p>В пакет backupninja-cloud также входит скрипт csrestore, предназначенный для восстановления данных.</p>

<p>Для того, чтобы восстановить данные, которые только что были загружены в облачное хранилище, нужно выполнить команду:</p>

<pre><code>csrestore /root/.restore/root.cstask
</code></pre>

<p>Скрипт считает такие данные, как логин, apikey, и контейнер, загрузит и распакует данные в директорию /var/restored/</p>

<p>Пример успешного выполнения скрипта:</p>

<p><img src="/images/cloudstorage/backupninja/bn_cloud_011.png" alt="" /></p>

<p>В /var/restored появится директория root со всем данными.</p>

<p><em>Обратите внимание</em>: если вы уже восстанавливали одноименную директорию, то перед следующим восстановлением потребуется сперва удалить старую восстановленную версию:</p>

<pre><code>rm -rf /var/restored/root
</code></pre>

<p>В противном случае скрипт не сработает и сообщит о том, что одноименная директория уже существует.</p>

<!-- ARTICLE _ END -->

<h6 class="usl">Условия использования документа</h6>
<p>Материал представленный на данной странице может быть использован Вами по своему усмотрению. Разрешается копирование и распространение предоставленного материала без изменения содержания и без предварительного уведомления администрации <a class='out' target='_blank' href="http://www.clodo.ru">Clodo.ru</a>.</p>
<p>Мы будем признательны Вам за сообщения об ошибках в представленной документации и за предложения об улучшении документации. По этим вопросам необходимо обращаться по адресу <a href="mailto:mail@clodo.ru">mail@clodo.ru</a>. При обращении не забывайте указывать URL-адрес публикации.</p>

					</div>
				</div>
			</div>

				</td>
			</tr>
		</table>
		</div>

			<div class="footer">
				Техническая поддержка: <a href="mailto:support@clodo.ru">support@clodo.ru</a> | СПб: +7 (812) 380-24-97 | Москва: +7 (499) 504-98-28 | Jabber: support@clodo.ru
			</div>

	</td></tr>
	</table>

</body>
</html>
